# MySQL 高频面试题

<br>

## 一、索引

### 1.1 根据索引底层数据结构分类

1. B+树。
1. B树。

<br>

### 1.2 根据索引是否保存全部数据分类

1. 聚簇索引（主键索引）：非叶节点保存主键值，叶节点保存完整的数据。
1. 非聚簇索引（二级索引）：非叶节点保存索引列的值，叶节点保存主键值。

<br>

### 1.3 根据索引创建的字段分类

1. **主键索引**（Primary Key Index）：每张表只能有一个主键索引，它用于唯一标识表中的每一行数据。主键索引的值不能为 NULL 。
1. **唯一索引**（Unique Index）：确保某列或列组合的值是唯一的，但允许为 NULL ，只要 NULL 值不是重复的。
1. **普通索引**（Index）：可以加快数据的查询速度，不保证列值的唯一性。
1. **前缀索引**。

<br>

### 1.4 根据索引中字段数量分类

1. **单列索引**：建立在单列上的索引。
1. **联合索引**：建立在多列上的索引。

<br>

### 1.5 如何查看是否命中索引

[执行计划解释](https://dev.mysql.com/doc/refman/5.7/en/explain-output.html)：

- `id`: 表示查询中每个 SELECT 部分的编号。
- `select_type`:
  - SIMPLE 表示简单的查询，不包含子查询或 JOIN 操作。
  - PRIMARY
  - UNION
  - SUBQUERY
- `table`: 表示正在查询的表名。
- `partitions`：如果表涉及分区，会显示相关分区信息，NULL 表示未分区。
- `type`：
  - const
  - ref 表示通过非唯一索引或唯一索引的前缀来查找匹配的行。
  - range 范围扫描，通常是在索引列上使用了范围操作符（<>, >, >=, <, <=, IS NULL, <=>, BETWEEN, LIKE, IN）。
  - fulltext
- `possible_keys`：可能使用的索引。
- `key`：实际使用的索引。
- `key_len`：索引使用的字节数。
- `ref`：
  - const 表示通过常量值来与索引进行比较。
- `rows`：估计需要扫描的行数。
- `filtered`：表示符合查询条件的结果占估计行数的百分比。
- `Extra`
  - Using where 表示使用了 WHERE 子句来过滤结果。
  - Using index 表示只需要通过索引就能获取到所需的数据，而不需要回表查询数据。

建表语句：

```sql
CREATE TABLE `tb_index_test_1` (
  `id` int NOT NULL AUTO_INCREMENT,
  `a` int NOT NULL,
  `b` int NOT NULL,
  `c` int NOT NULL,
  PRIMARY KEY (`id`),
  KEY `a_b_c` (`a`,`b`,`c`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO tb_index_test_1 (a, b, c) VALUES (1, 1, 1);
```

单条件精确查询：

```sql
mysql> explain select * from tb_index_test_1 where a = 1;
+----+-------------+-----------------+------------+------+---------------+-------+---------+-------+------+----------+-------------+
| id | select_type | table           | partitions | type | possible_keys | key   | key_len | ref   | rows | filtered | Extra       |
+----+-------------+-----------------+------------+------+---------------+-------+---------+-------+------+----------+-------------+
|  1 | SIMPLE      | tb_index_test_1 | NULL       | ref  | a_b_c         | a_b_c | 4       | const |    9 |   100.00 | Using index |
+----+-------------+-----------------+------------+------+---------------+-------+---------+-------+------+----------+-------------+
```

```sql
mysql> explain select * from tb_index_test_1 where b = 1;
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
| id | select_type | table           | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | tb_index_test_1 | NULL       | index | a_b_c         | a_b_c | 12      | NULL |   27 |    10.00 | Using where; Using index |
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
```

单条件范围查询：

```sql
mysql> explain select * from tb_index_test_1 where a > 1;
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
| id | select_type | table           | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | tb_index_test_1 | NULL       | range | a_b_c         | a_b_c | 4       | NULL |   18 |   100.00 | Using where; Using index |
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
```

```sql
mysql> explain select * from tb_index_test_1 where a >= 1;
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
| id | select_type | table           | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | tb_index_test_1 | NULL       | index | a_b_c         | a_b_c | 12      | NULL |   27 |   100.00 | Using where; Using index |
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
```

```sql
mysql> explain select * from tb_index_test_1 where a <> 1;
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
| id | select_type | table           | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | tb_index_test_1 | NULL       | range | a_b_c         | a_b_c | 4       | NULL |   19 |   100.00 | Using where; Using index |
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
```

多条件精确查询：

```sql
mysql> explain select * from tb_index_test_1 where a = 1 and b = 2;
+----+-------------+-----------------+------------+------+---------------+-------+---------+-------------+------+----------+-------------+
| id | select_type | table           | partitions | type | possible_keys | key   | key_len | ref         | rows | filtered | Extra       |
+----+-------------+-----------------+------------+------+---------------+-------+---------+-------------+------+----------+-------------+
|  1 | SIMPLE      | tb_index_test_1 | NULL       | ref  | a_b_c         | a_b_c | 8       | const,const |    3 |   100.00 | Using index |
+----+-------------+-----------------+------------+------+---------------+-------+---------+-------------+------+----------+-------------+
```

```sql
mysql> explain select * from tb_index_test_1 where a = 1 and c = 3;
+----+-------------+-----------------+------------+------+---------------+-------+---------+-------+------+----------+--------------------------+
| id | select_type | table           | partitions | type | possible_keys | key   | key_len | ref   | rows | filtered | Extra                    |
+----+-------------+-----------------+------------+------+---------------+-------+---------+-------+------+----------+--------------------------+
|  1 | SIMPLE      | tb_index_test_1 | NULL       | ref  | a_b_c         | a_b_c | 4       | const |    9 |    10.00 | Using where; Using index |
+----+-------------+-----------------+------------+------+---------------+-------+---------+-------+------+----------+--------------------------+
```

```sql
mysql> explain select * from tb_index_test_1 where b = 2 and a = 1;
+----+-------------+-----------------+------------+------+---------------+-------+---------+-------------+------+----------+-------------+
| id | select_type | table           | partitions | type | possible_keys | key   | key_len | ref         | rows | filtered | Extra       |
+----+-------------+-----------------+------------+------+---------------+-------+---------+-------------+------+----------+-------------+
|  1 | SIMPLE      | tb_index_test_1 | NULL       | ref  | a_b_c         | a_b_c | 8       | const,const |    3 |   100.00 | Using index |
+----+-------------+-----------------+------------+------+---------------+-------+---------+-------------+------+----------+-------------+
```

```sql
mysql> explain select * from tb_index_test_1 where b = 2 and c = 3;
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
| id | select_type | table           | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | tb_index_test_1 | NULL       | index | a_b_c         | a_b_c | 12      | NULL |   27 |     3.70 | Using where; Using index |
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
```

多条件范围查询：

```sql
mysql> explain select * from tb_index_test_1 where a = 1 and b >= 2;
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
| id | select_type | table           | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | tb_index_test_1 | NULL       | range | a_b_c         | a_b_c | 8       | NULL |    6 |   100.00 | Using where; Using index |
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
```

```sql
mysql> explain select * from tb_index_test_1 where a >= 1 and b = 2;
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
| id | select_type | table           | partitions | type  | possible_keys | key   | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | tb_index_test_1 | NULL       | range | a_b_c         | a_b_c | 8       | NULL |   24 |    10.00 | Using where; Using index |
+----+-------------+-----------------+------------+-------+---------------+-------+---------+------+------+----------+--------------------------+
```

<br>

### 1.6 索引失效的场景

1. 不满足最左匹配原则。
1. 索引列上使用函数、类型转换。

<br>

### 1.7 索引命中实战

<br>

### 1.8 索引优化

<br>

## 二、存储

<br>

## 三、事务

<br>
